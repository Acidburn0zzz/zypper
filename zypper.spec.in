#
# spec file for package zypper
#
# Copyright (c) 2006 SUSE LINUX Products GmbH, Nuernberg, Germany.
# This file and all modifications and additions to the pristine
# package are under the same license as the package itself.
#
# Please submit bugfixes or comments via http://bugs.opensuse.org/
#

# norootforbuild

Name:           @PACKAGE@
# da library
BuildRequires:  libzypp-devel
BuildRequires:  gcc-c++ pkg-config boost-devel gettext-devel
Requires:	procps
License:        GPL
Group:          System/Packages
BuildRoot:      %{_tmppath}/%{name}-%{version}-build
Autoreqprov:    on
PreReq:         permissions
Summary:        Command Line Package Management Using Libzypp
Version:        @VERSION@
Release:        0
Source:         @PACKAGE@-@VERSION@.tar.bz2
Prefix:         /usr
# zypper is not a fully featured replacement yet
#Provides:       y2pmsh
#Obsoletes:      y2pmsh

%description
Command Line Package Management Using Libzypp

Authors:
--------
    Jan Kupec <jkupec@suse.cz>
    Duncan Mac-Vicar <dmacvicar@suse.de>
    Martin Vidner <mvidner@suse.cz>

%prep
%setup -q

%build
gettextize -f
autoreconf --force --install --symlink --verbose
%{?suse_update_config:%{suse_update_config -f}}
%if %suse_version <= 1010
ZYPP_LIBS=-lzypp ZYPP_CFLAGS="-D_FILE_OFFSET_BITS=64 -DLIBZYPP_1xx" \
%endif
CFLAGS="$RPM_OPT_FLAGS" \
CXXFLAGS="$RPM_OPT_FLAGS" \
./configure --prefix=%{prefix} --libdir=%{_libdir} --mandir=%{_mandir} --sysconfdir=%{_sysconfdir} --disable-static
make %{?jobs:-j %jobs}
#make check

%install
make install DESTDIR=$RPM_BUILD_ROOT
# Create filelist with translatins
%{find_lang} zypper

%post
%run_ldconfig
%if %suse_version > 1010
%run_permissions
%endif

%if %suse_version > 1010
%verifyscript
%verify_permissions -e %{_sbindir}/zypp-checkpatches-wrapper
%endif

%postun
%run_ldconfig

%clean

%files -f zypper.lang
%defattr(-,root,root)
%{_sysconfdir}/logrotate.d/zypper.lr
%{_bindir}/zypper
%{_bindir}/installation_sources
%if %suse_version > 1010
%{_sbindir}/zypp-checkpatches
%verify(not mode) %attr (755,root,root) %{_sbindir}/zypp-checkpatches-wrapper
%endif
%doc %{_mandir}/*/*
%doc %dir %{_datadir}/doc/packages/zypper
%doc %{_datadir}/doc/packages/zypper/TODO
%doc %{_datadir}/doc/packages/zypper/zypper-rug
